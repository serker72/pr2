 <script type="text/javascript" src="/js/select2/select2.min.js"></script> 
<script type="text/javascript" src="/js/select2/select2_locale_ru.js"></script>

<link href="/js/select2/select2.css?v=1" rel="stylesheet"/>
 
<script type="text/javascript">
$(function(){

	$.datepicker.setDefaults($.extend($.datepicker.regional['ru']));
	
	$("#pdate_1%{$prefix}%").datepicker({changeMonth: true, changeYear:true, yearRange: '2012:+15'});
	$("#pdate_2%{$prefix}%").datepicker({changeMonth: true, changeYear:true, yearRange: '2012:+15'});
	
	
	$("#pdate1_1%{$prefix}%").datepicker({changeMonth: true, changeYear:true, yearRange: '2012:+15'});
	$("#pdate1_2%{$prefix}%").datepicker({changeMonth: true, changeYear:true, yearRange: '2012:+15'});
	
	
	VidgetMultiReport('%{$prefix}%statuses', 'Выберите статус', 'Все статусы', 'Cнять выбор', '# из # выбрано', "Выбраны статусы: ", 'Статусы не выбраны', 280 );
	
	VidgetMultiReport('%{$prefix}%states', 'Выберите состояние', 'Все состояния', 'Cнять выбор', '# из # выбрано', "Выбраны состояния: ", 'Состояния не выбраны', 180 );
	
	
	 
	
	function split( val ) {
			return val.split( /;\s*/ );
		}
		function extractLast( term ) {
			return split( term ).pop();
		}
		
			 
 
		
	 function SelectSupplierGo2(name){
		var mode=mode;
		 $("#"+name).select2(
		 
		 {
		
		multiple: true,
		minimumInputLength:2,
		separator:';',
		
		ajax: {
				url: "/js/an_sched_supplier.php",
				dataType: 'json',
				quietMillis: 100,
				data: function (term, page) {
					return {
						term: term, //search term
						page_limit: 10 // page size
					};
				},
				results: function (data, page) {
					return { results: data.results };
				}
	
			},
			initSelection: function(element, callback) {
				//var data = {id: element.val(), text: element.val()};
				var data = new Array();  
				//data.push({id: '4', text: 'lelelelel'});
				
				
				
				
				 
				%{foreach from=$our_suppliers item=item}%
				data.push({id: '%{$item.id|escape:"html"}%', text: '%{$item.code|escape:"html"}% %{$item.full_name|escape:"html"}%, %{$item.opf_name|escape:"html"}%'});
				 
				%{/foreach}%
				
				 
				
				callback(data);
			}
		 }
		 );  
	}
	
	
	
	function SelectGo2(name ){
		 
		 $("#"+name).select2(
		 
		 {
		
		multiple: true,
		minimumInputLength:2,
		separator:';',
		
		ajax: {
				url: "/js/an_sched.php",
				dataType: 'json',
				quietMillis: 100,
				data: function (term, page) {
					return {
						term: term, //search term
						page_limit: 10 // page size
					};
				},
				results: function (data, page) {
					return { results: data.results };
				}
	
			},
			initSelection: function(element, callback) {
				//var data = {id: element.val(), text: element.val()};
				var data = new Array();  
				//data.push({id: '4', text: 'lelelelel'});
				
				
				
				
				 
				%{foreach from=$our_users item=item}%
				data.push({id: '%{$item.id|escape:"html"}%', text: '%{$item.name_s|escape:"html"}%, %{$item.position_s|escape:"html"}%'});
				 
				%{/foreach}%
				
			 
				 
				
				callback(data);
			}
		 }
		 );  
	}
			
	function SelectProducerGo2(name ){
		 
		 $("#"+name).select2(
		 
		 {
		
		multiple: true,
		minimumInputLength:2,
		separator:';',
		
		ajax: {
				url: "/js/an_tele_prod.php",
				dataType: 'json',
				quietMillis: 100,
				data: function (term, page) {
					return {
						term: term, //search term
						page_limit: 10 // page size
					};
				},
				results: function (data, page) {
					return { results: data.results };
				}
	
			},
			initSelection: function(element, callback) {
				//var data = {id: element.val(), text: element.val()};
				var data = new Array();  
				//data.push({id: '4', text: 'lelelelel'});
				
				
				
				
				 
				%{foreach from=$our_producers item=item}%
				data.push({id: '%{$item.id|escape:"html"}%', text: '%{$item.name|escape:"html"}%'});
				 
				%{/foreach}%
				
			 
				 
				
				callback(data);
			}
		 }
		 );  
	}		
		

		function SelectCityGo2(name){
		var mode=mode;
		 $("#"+name).select2(
		 
		 {
		
		multiple: true,
		minimumInputLength:2,
		separator:';',
		
		ajax: {
				url: "/js/an_sched_city.php",
				dataType: 'json',
				quietMillis: 100,
				data: function (term, page) {
					return {
						term: term, //search term
						page_limit: 10 // page size
					};
				},
				results: function (data, page) {
					return { results: data.results };
				}
	
			},
			initSelection: function(element, callback) {
				//var data = {id: element.val(), text: element.val()};
				var data = new Array();  
				//data.push({id: '4', text: 'lelelelel'});
				
				
				
				
				 
				%{foreach from=$our_cities item=item}%
				data.push({id: '%{$item.id|escape:"html"}%', text: '%{$item.fullname|escape:"html"}%'});
				 
				%{/foreach}%
				
				 
				
				callback(data);
			}
		 }
		 );  
	}
	
	
	function SelectCntryGo2(name){
		var mode=mode;
		 $("#"+name).select2(
		 
		 {
		
		multiple: true,
		minimumInputLength:2,
		separator:';',
		
		ajax: {
				url: "/js/an_sched_country.php",
				dataType: 'json',
				quietMillis: 100,
				data: function (term, page) {
					return {
						term: term, //search term
						page_limit: 10 // page size
					};
				},
				results: function (data, page) {
					//alert(data.results[0].);
					return { results: data.results };
				}
	
			},
			initSelection: function(element, callback) {
				//var data = {id: element.val(), text: element.val()};
				var data = new Array();  
				//data.push({id: '4', text: 'lelelelel'});
				
				
				
				
				 
				%{foreach from=$our_countries item=item}%
				data.push({id: '%{$item.id|escape:"html"}%', text: '%{$item.name|escape:"html"}%'});
				 
				%{/foreach}%
				
				 
				
				callback(data);
			} 
		 }
		 );  
	}
	
	function SelectFoGo2(name){
		var mode=mode;
		 $("#"+name).select2(
		 
		 {
		
		multiple: true,
		minimumInputLength:2,
		separator:';',
		
		ajax: {
				url: "/js/an_sched_fo.php",
				dataType: 'json',
				quietMillis: 100,
				data: function (term, page) {
					return {
						term: term, //search term
						page_limit: 10 // page size
					};
				},
				results: function (data, page) {
					//alert(data.results[0].);
					return { results: data.results };
				}
	
			},
			initSelection: function(element, callback) {
				//var data = {id: element.val(), text: element.val()};
				var data = new Array();  
				//data.push({id: '4', text: 'lelelelel'});
				
				
				
				
				 
				%{foreach from=$our_fos item=item}%
				data.push({id: '%{$item.id|escape:"html"}%', text: '%{$item.name|escape:"html"}%'});
				 
				%{/foreach}%
				
				 
				
				callback(data);
				
				
			}
		 }
		 );  
	}
	 
	
	SelectSupplierGo2("supplier_name%{$prefix}%");
	SelectGo2("manager_name%{$prefix}%");
	
	SelectProducerGo2("producer_name%{$prefix}%");	
	
		 SelectCityGo2("city%{$prefix}%");
	

	
	SelectCntryGo2("country%{$prefix}%");
	SelectFoGo2("fo%{$prefix}%");
	
	
	$("#country%{$prefix}%")
    .on("change", function(e) { 
	
		//alert(JSON.stringify({val:e.val, added:e.added, removed:e.removed}) );
		
		if($.inArray("1",  e.val)!=-1){
			//разблокировать фо	
			$("#fo%{$prefix}%").select2("enable", true);
		}else{
			//заблокировать, очистить ФО
			 $("#fo%{$prefix}%").select2("val", ""); 
			 //$("#fo%{$prefix}%").select2("enable", false);
				
		}
	});
		
	/*if($.inArray("1",  $("#country%{$prefix}%").select2("val"))==-1){
		$("#fo%{$prefix}%").select2("val", ""); 
		$("#fo%{$prefix}%").select2("enable", false);	
	}*/
	
	$("#fo%{$prefix}%")
    .on("change", function(e) { 
		if(e.val.length>0){
			//выбрать россию!
			$("#country%{$prefix}%").select2("data",  {id: 1, text: "Россия"} ); 	
		}else{
			
		}
	});
	
	
	 $("#print_table%{$prefix}%").bind("click",function(){
			// $("#print").val(1);
	 		//alert('doSub=1&print=1&'+$("#rep_form2").serialize());
			 
			
		 	 window.open('an_tele.php?'+'doSub%{$prefix}%=1&print=1&'+$("#rep_form%{$prefix}%").serialize());
		   
		 return false; 
	  });   
	
	
	$("#wo_producer%{$prefix}%").bind("change",function(){
		if($("#wo_producer%{$prefix}%").prop("checked")){
			$("#producer_name%{$prefix}%").select2('val', '');
			$("#producer_name%{$prefix}%").select2('enable', false);
		}else{
			 
			$("#producer_name%{$prefix}%").select2('enable', true);
		}
	});
});
</script>



%{section name=rowsec loop=$items}%%{/section}%


%{$pages}%

<form action="%{$pagename}%" method="get" id="rep_form%{$prefix}%">
 
<input type="hidden" name="tab_page" value="2"  />
<input type="hidden" name="sortmode%{$prefix}%" value="%{$sortmode}%" id="sortmode%{$prefix}%" />





<div class="report_filter_right">
  
  <div class="reestr_zoom reestr_right_button24" data-comment="Вывести">
  <input type="image" src="/img/24.png" value="Вывести" alt="Вывести"  name="doSub%{$prefix}%"  />
  </div>
  
  <a href="%{$pagename}%?doSub%{$prefix}%=1&tab_page=2"  class="reestr_zoom_deselect reestr_right_button24" data-comment="Сбросить все фильтры"></a>
  
   %{if $can_print}%
    %{section name=rowsec loop=$items}%%{/section}%
    
     <a href="#" id="print_table%{$prefix}%" class="reestr_print reestr_right_button24 " data-comment="Печать..." ></a>
    
    
   
    
    
    %{else}%
    <a href="#" onclick="alert('У Вас недостаточно прав для печати отчета.'); return false;"  class="reestr_print reestr_inactive reestr_right_button24 " data-comment="Печать..."></a>
   %{/if}%
  
  
  %{include file="every_help_dialog.html" filename="an_leads.html" description="Отчет Лиды"  prefix=$prefix style="display:inline;" is_right=true}%


</div>








 


<div class="report_filter_left">
	 
     <div class="report_filter">
    
     
    
    
        <label for="%{$prefix}%statuses" class="statuses_report_label">Статусы:</label><br>
    
        <select id="%{$prefix}%statuses" name="%{$prefix}%statuses[]" multiple="multiple">
       
           <option value="18" %{if $status_id_18==1 or $all_statuses==1}% selected%{/if}% >Создан</option>
<option value="33" %{if $status_id_33==1 or $all_statuses==1}% selected%{/if}% >Новый</option>
<option value="2" %{if $status_id_2==1 or $all_statuses==1}% selected%{/if}% >Утвержден</option>
<option value="28" %{if $status_id_28==1 or $all_statuses==1}% selected%{/if}% >В работе</option>

<option value="37" %{if $status_id_37==1 or $all_statuses==1}% selected%{/if}% >Подтвердить отказ</option>
<option value="34" %{if $status_id_34==1 or $all_statuses==1}% selected%{/if}% >Отказ</option>
<option value="35" %{if $status_id_35==1 or $all_statuses==1}% selected%{/if}% >На рассмотрении</option>
<option value="25" %{if $status_id_25==1 or $all_statuses==1}% selected%{/if}% >Отложен</option>

<option value="32" %{if $status_id_32==1 or $all_statuses==1}% selected%{/if}% >Отменен</option>
<option value="36" %{if $status_id_36==1 or $all_statuses==1}% selected%{/if}% >Упущен</option>
<option value="26" %{if $status_id_26==1 or $all_statuses==1}% selected%{/if}% >Ждет контроля</option>
<option value="23" %{if $status_id_23==1 or $all_statuses==1}% selected%{/if}% >Ждет выполнения</option>
<option value="29" %{if $status_id_29==1 or $all_statuses==1}% selected%{/if}% >Заявлен</option>
 
<option value="30" %{if $status_id_30==1 or $all_statuses==1}% selected%{/if}% >Выигран</option> 
<option value="31" %{if $status_id_31==1 or $all_statuses==1}% selected%{/if}% >Проигран</option> 
 

<option value="3"  %{if $status_id_3==1 or $all_statuses==1}% selected%{/if}%>Аннулирован</option>
      
        </select>
        
        
        
        <br clear="all" />
        
        <div id="%{$prefix}%statuses_caption" class="statuses_report_caption" style="width:270px !important;">
        
        </div>
    
    
    </div>
     
     
    
   <div class="report_filter">
    <strong>Дата создания лида:</strong>
    <br>
    
    
    <label for="pdate_1%{$prefix}%">с:&nbsp;</label><input type="text" id="pdate_1%{$prefix}%" name="pdate_1%{$prefix}%" value="%{$pdate_1}%" size="10" maxlength="10"  class="sched_report_field" />
     &nbsp;&nbsp;
    <label for="pdate_2%{$prefix}%">по:&nbsp;</label><input type="text" id="pdate_2%{$prefix}%" name="pdate_2%{$prefix}%" value="%{$pdate_2}%" size="10" maxlength="10"  class="sched_report_field" />
    
    </div>
     
     
        <div class="report_filter">
    <strong> Прогноз. дата закл-ия контракта:</strong>
    <br>
    
    
    <label for="pdate1_1%{$prefix}%">с:&nbsp;</label><input type="text" id="pdate1_1%{$prefix}%" name="pdate1_1%{$prefix}%" value="%{$pdate1_1}%" size="10" maxlength="10"  class="sched_report_field" />
     &nbsp;&nbsp;
    <label for="pdate1_2%{$prefix}%">по:&nbsp;</label><input type="text" id="pdate1_2%{$prefix}%" name="pdate1_2%{$prefix}%" value="%{$pdate1_2}%" size="10" maxlength="10"  class="sched_report_field" />
    
    </div>  
   
    
    
    
        
  <div class="report_filter">
    
     
    
    
        <label for="%{$prefix}%states" class="statuses_report_label">Состояние:</label><br>
    
        <select id="%{$prefix}%states" name="%{$prefix}%states[]" multiple="multiple">
       
            <option value="0" %{if $state_0==1 or $all_states==1}% selected%{/if}% >Холодный</option>
            <option value="1" %{if $state_1==1 or $all_states==1}% selected%{/if}% >Теплый</option>
            <option value="2" %{if $state_2==1 or $all_states==1}% selected%{/if}% >Горячий</option>
        </select>
        
        
        
        <br clear="all" />
        
        <div id="%{$prefix}%states_caption" class="statuses_report_caption" style="width:170px !important;">
        
        </div>
    
    
    </div>
     
    
   <div class="report_filter">
    
     
    
    
        <label for="kinds%{$prefix}%" >Вид:</label><br>
    
        <select id="kinds%{$prefix}%" name="kinds%{$prefix}%" style="width:100px;" class="sched_report_field">
            <option value="" %{if $kind==""}% selected%{/if}% >-все-</option> 
            %{foreach from=$kinds item=item}%
            <option value="%{$item.id}%" %{if  $item.id==$kind}% selected%{/if}% >%{$item.name}%</option> 
            %{/foreach}%
            
        </select>
        
        
    
    
    </div>
    
    
    
   <div class="report_filter">
    
    
        <label for="eq_type%{$prefix}%"  >Тип оборудования:</label><br>
    
        <select id="eq_type%{$prefix}%" name="eq_type%{$prefix}%" style="width:280px;" class="sched_report_field">
            <option value="" %{if $eq_type==""}% selected%{/if}% >-все-</option> 
            %{foreach from=$eqs item=item}%
            <option value="%{$item.id}%" %{if $eq_type==$item.id}% selected%{/if}% >%{$item.name}%</option> 
            %{/foreach}%
            
        </select>
        
    
    
    </div>
    
    
   <div class="report_filter">
    
    
        <label for="topic%{$prefix}%"  >Название:</label><br>
        <input type="text" id="topic%{$prefix}%" name="topic%{$prefix}%" value="%{$topic|escape:"html"}%" size="30" maxlength="255" style="width:180px;" class="sched_report_field"/>
        
        
    
    
    </div>
    
    
    
   <div class="report_filter">
    
    
        <label for="supplier_name%{$prefix}%"  >Контрагент:</label><br>
        <input type="text" id="supplier_name%{$prefix}%" name="supplier_name%{$prefix}%" value="%{$supplier_name|escape:"html"}%" size="30" maxlength="255" style="width:180px;"/>
        
         <br>
  
  <input type="checkbox" id="has_holdings%{$prefix}%" name="has_holdings%{$prefix}%" value="1" %{if $has_holdings}% checked%{/if}%>
  <label for="has_holdings%{$prefix}%">Включая субхолдинги <br>
и подчиненные предприятия</label>
    
    
    
    </div>
    
    
    
    
    <div class="report_filter">
    <label for="country%{$prefix}%">Страна контрагента:</label><br />
    <input type="text" value="%{$country}%" id="country%{$prefix}%" name="country%{$prefix}%" size="30" maxlength="512" style="width:180px;" class="sched_report_field"  />
    </div>
    
    
     <div class="report_filter">
    <label for="fo%{$prefix}%">Фед. округ контрагента:</label><br />
    <input type="text" value="%{$fo}%" id="fo%{$prefix}%" name="fo%{$prefix}%" size="30" maxlength="512" style="width:180px;" class="sched_report_field"  />
    
    
        <div   class="statuses_report_caption">
		Только для России            
        </div>
    </div>
    
     
   <div class="report_filter">
    <label for="city%{$prefix}%">Город контрагента:</label><br />
    <input type="text" value="%{$city}%" id="city%{$prefix}%" name="city%{$prefix}%" size="30" maxlength="512" style="width:180px;"  />
    </div>
    
    <div class="report_filter">
    
    
        <label for="producer_name%{$prefix}%"  >Производитель:</label><br>
        <input type="text" id="producer_name%{$prefix}%" name="producer_name%{$prefix}%" value="%{$producer_name|escape:"html"}%" size="30" maxlength="255" style="width:180px;" %{if $wo_producer==1}% disabled%{/if}%/>
        
        
    
    
    </div>
    
    
    
   <div class="report_filter">
    	<br>

    	<input type="checkbox" id="wo_producer%{$prefix}%" name="wo_producer%{$prefix}%" value="1" %{if $wo_producer==1}% checked%{/if}% >
        <label for="wo_producer%{$prefix}%"  >Только без производителя</label>
        
        
    
    
    </div>
    
   <div class="report_filter">
    
    
        <label for="manager_name%{$prefix}%"  >Отв. сотрудник:</label><br>
        <input type="text" id="manager_name%{$prefix}%" name="manager_name%{$prefix}%" value="%{$manager_name|escape:"html"}%" size="30" maxlength="255" style="width:180px;"/>
        
        
    
    
    </div>
    
     
    
    
    
    
   <div class="report_filter">
    
    
        <label for="content%{$prefix}%"  >Содержание:</label><br>
        <input type="text" id="content%{$prefix}%" name="content%{$prefix}%" value="%{$content|escape:"html"}%" size="30" maxlength="255" style="width:180px;"/>
        
        
    
    
    </div>
    
    
    
   <div class="report_filter">
    <br>
    
    <input type="checkbox" id="has_content%{$prefix}%" name="has_content%{$prefix}%" value="1" %{if $has_content}% checked%{/if}%>
    <label for="has_content%{$prefix}%">Расширенная форма</label>
    
    </div>
    
    
    


</div>




 

<br clear="all" />
 
</form>



<small>
Примечания.

<br />
<br />
1. <strong>Расширенная форма отчета</strong> позволяет включить в отчет комментарии.<br />
<br />


</small>

%{if $do_it}%
%{include file="an_tele/an_tele_lead_table.html"}%
%{/if}%





