<script type="text/javascript" src="/js/gen_validatorv4.js"></script>
<script type="text/javascript">
var was_changed=false;
$(function(){
$.datepicker.setDefaults($.extend($.datepicker.regional['ru']));
	$("#pasp_kogda").datepicker({changeYear:true, yearRange: '1900:2012'});
	 $("#pasp_bithday").datepicker({changeYear:true, yearRange: '1900:2012'});
	 
	 
	 $.each($("#crea_form input"), function(key, value){
	 	$(value).bind("change",function(){
			was_changed=was_changed||true;
		});
	});
	
	$.each($("#crea_form select"), function(key, value){
	 	$(value).bind("change",function(){
			was_changed=was_changed||true;
		});
	});
	
	$.each($("#crea_form textarea"), function(key, value){
	 	$(value).bind("change",function(){
			was_changed=was_changed||true;
		});
	});
	 
});
</script>

<form action="%{$pagename}%" method="post" id="crea_form">
<input type="hidden" name="action" value="0" />
%{include file="every_help_dialog.html" filename="user_create.htm" prefix="" description="создание карты сотрудника"  style="float:right;  margin-right:10px;"}%


<div style="float:left; margin-right:20px;">
<label for="login">Логин:</label><br>
<input type="text" size="5" maxlength="5" value="%{$login}%" disabled="disabled" />
<input type="hidden" name="login" value="%{$login}%" />
</div>


%{if $can_block}%
<div style="float:left; margin-right:20px;">
<input type="checkbox" name="is_active" id="is_active" value="1" />
<label for="is_active">Карта пользователя активна</label><br>
<p />
</div>
%{/if}%


<br clear="all" />
<p />




<label for="password">Пароль:</label><br>
<input type="text" size="20" maxlength="255" name="password" id="password" /><br />
<small><em>минимальная длина 6 символов; допустимые символы - латинские буквы и цифры</em></small>
<p />

<div style="float:left; margin-right:20px;">
<label for="name_s">Ф.И.О.:</label><br>
<input type="text" size="40" maxlength="255" name="name_s" />
</div>

<div style="float:left; margin-right:20px;">



<label for="position_id">Должность:</label><br />
 <select name="position_id" id="position_id" style="width:260px;">
  %{include file="users_v/groups_opt.html"  group_values=$position_id_values group_ids=$position_id_ids group_id=0}%
  </select>	
 
  
   
   <input type="button" value="Должности..." id="expand_userpos" />
   %{include file="users_v/userpos_dialog.html" word="userpos" named="Должность" opfs_total=$position_ids}%
 
</div>


<br clear="all" />
<p />


<div style="float:left; margin-right:20px;">
<label for="department_id">Отдел:</label><br />
 <select name="department_id" id="department_id" style="width:270px;">
  %{include file="users_v/deps_opt.html"  group_values=$department_id_values group_ids=$department_id_ids group_id=0}%
  </select>	

 <input type="button" value="Отделы..." id="expand_deps" />
   %{include file="users_v/deps_dialog.html" word="deps" named="Отдел" opfs_total=$department_ids}%
 

</div>


<div style="float:left; margin-right:20px;"><br />

<input type="checkbox" id="is_in_plan_fact_sales" name="is_in_plan_fact_sales" value="1" />
<label for="is_in_plan_fact_sales">Участие в плане/факте продаж</label>

</div>



<input type="hidden" name="group_id" id="group_id" value="2" />



<br clear="all" />
<p />

<div style="float:left; margin-right:20px;">
<label for="manager_id">Менеджер:</label><br />
 <select name="manager_id" id="manager_id" style="width:270px;">
  %{$managers}%
  </select>	
</div>


<br clear="all" />
<p />

<!--
<strong>Время работы (МСК):</strong>
<div style="float:left; margin-right:30px; white-space:nowrap;">
<label for="time_from_h_s">с:</label>
<select name="time_from_h_s" style="width:60px">
	%{html_options values=$from_hrs selected=$from_hr output=$from_hrs}%
</select>час. 
<select name="time_from_m_s" style="width:60px">
	%{html_options values=$from_ms selected=$from_m output=$from_ms}%
</select>мин.
</div>

<div style="float:left; margin-right:30px; white-space:nowrap;">
<label for="time_to_h_s">по:</label>
<select name="time_to_h_s" style="width:60px">
	%{html_options values=$to_hrs selected=$to_hr output=$to_hrs}%
</select>час. 
<select name="time_to_m_s" style="width:60px">
	%{html_options values=$to_ms selected=$to_m output=$to_ms}%
</select>мин.
</div>
<br clear="all" />
<p />

-->
 
 

<!--

<h4>Паспортные данные:</h4>

<div style="float:left; margin-right:20px;">

<label for="pasp_ser">Серия:</label><br />
<input type="text" size="15" maxlength="255" name="pasp_ser" />
</div>

<div style="float:left; margin-right:20px;">

<label for="pasp_no">№:</label><br />
<input type="text" size="15" maxlength="255" name="pasp_no" />
</div>


<div style="float:left; margin-right:20px;">

<label for="pasp_kogda">Дата выдачи:</label><br />
<input type="text" size="15" maxlength="255" name="pasp_kogda" id="pasp_kogda" />
</div>

<div style="float:left; margin-right:20px;">

<label for="pasp_kogda">Дата рождения:</label><br />
<input type="text" size="15" maxlength="255" name="pasp_bithday" id="pasp_bithday" />
</div>

<br clear="all" />
<p />


<div style="float:left; margin-right:20px;">
<label for="pasp_kem">Кем выдан:</label><br />
<textarea cols="30" rows="5" name="pasp_kem" style="height:40px;"></textarea>
</div>

<div style="float:left; margin-right:20px;">
<label for="pasp_reg">Адрес регистрации:</label><br />
<textarea cols="60" rows="5" name="pasp_reg" style="height:40px;"></textarea>
</div>

<br clear="all" />
<p />
-->


%{if $can_create}%
<input type="submit" name="doNew" value="Создать пользователя" />
%{/if}%

%{if $can_edit}%
<input type="submit" name="doNewEdit" value="Создать пользователя и редактировать права" />
%{/if}%

<input type="button" id="do_close" value="Закрыть форму" onclick="if(was_changed){
if(window.confirm('Вы уверены, что хотите закрыть форму? Все несохраненные изменения будут утрачены.')) location.href='users_s.php';
}else location.href='users_s.php';" />


</form>
<script type="text/javascript">
$(function(){
	$("#crea_form").bind("submit",function(){
		//проверка пароля - мин 6 символов, лат буквы+цифры
		can_submit=true;
		
		if($("#password").attr("value").length<6) can_submit=can_submit&&false;
		
		reg1=new RegExp("[A-Za-z]+");
		reg2=new RegExp("[0-9]+");
		
		if($("#password").attr("value").search(reg1)==-1) can_submit=can_submit&&false;
		if($("#password").attr("value").search(reg2)==-1) can_submit=can_submit&&false;
		
		
		if(!can_submit){
			alert("Пароль должен быть 6 символов и длиннее и состоять только из латинских букв и цифр!");	
			$("#password").focus();
		}
		
		return can_submit;
	});
});
</script>