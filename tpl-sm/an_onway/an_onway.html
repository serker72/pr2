<script type="text/javascript">
$(function(){
	
	$.datepicker.setDefaults($.extend($.datepicker.regional['ru']));
	 
	
	$("#pdate_shipping_plan1").datepicker({changeYear:true, yearRange: '2012:+00'});
	$("#pdate_shipping_plan2").datepicker({changeYear:true, yearRange: '2012:+00'});
	
	
	
});
</script>



<form action="%{$pagename}%" method="get" id="rep_form2">
<input type="hidden" name="print" value="0" id="print" />
<input type="hidden" name="tab_page" value="1" id="tab_page" />


%{include file="every_help_dialog.html" filename="an_onway.htm" prefix="" description="отчет товары в пути"  style="float:right;  margin-right:10px;"}%


<div style="float:left; margin-right:10px;">
<strong>Период:</strong>
<label for="pdate_shipping_plan1">с:</label><br />
<input type="text" name="pdate_shipping_plan1" id="pdate_shipping_plan1" size="10" maxlength="10" value="%{$pdate_shipping_plan1}%" />


<p />
	<label for="pdate_shipping_plan2">по:</label><br />
    <input type="text" name="pdate_shipping_plan2" id="pdate_shipping_plan2" size="10" maxlength="10" value="%{$pdate_shipping_plan2}%" />
</div>








<div style="float:left; margin-right:5px; max-width:350px;" id="search_shorter">
<strong>Поиск по наименованию позиции:</strong><br />

<input type="text" style="width:300px;" size="80" maxlength="255" value="%{$name2}%" name="name2" id="name2_1" /> <a href="#" id="do_ext_search"><img src="/img/icons/plus.png" width="24" height="24" alt="расширенный поиск" title="расширенный поиск" border="0" hspace="5" align="absmiddle" /></a>
<br /><br />


</div>


<div style="float:left; margin-right:5px; display:none;" id="search_full">
<table width="*" border="1" cellspacing="0" cellpadding="3" style="float:left; margin-right:10px;" class="blacktable">
 <thead>
  <tr align="left" valign="bottom">
    <th scope="col" width="40"> Код позиции</th>
	<th scope="col" width="*">Наименование</th> 
    <th width="40" scope="col" >
    ед.изм.
   
    </th>
    
     <th scope="col" width="100" >
    Товарная группа/ подгруппа&nbsp;1&nbsp;ур./ подгруппа&nbsp;2&nbsp;ур.
   
    </th>
    <th scope="col" width="40" >
    ГОСТ/ТУ
   
    </th>
    
    
    
     <th width="40" scope="col">
    Длина, мм
   
    </th>
    <th width="40" scope="col" >
    Ширина, мм
   
    </th>
    <th width="40" scope="col" >
    Высота/ толщина, мм
   
    </th>
    <th width="40" scope="col">
    Диаметр, мм:
    </th>   
    
  
  </tr>
  <tr align="left" valign="top">
  	
    
    <td  width="40"> 
     <input type="text" size="8" maxlength="255" value="%{$id2}%" name="id2" id="id2" style="width:40px;" />
    </td>
	<td  width="*">
    <input type="text" size="20" maxlength="255" value="%{$name2}%" name="nn" id="name2" />
    </td> 
    
     
    <td width="40" >
     <select name="dimension_id2" id="dimension_id2" style="width:40px;">
    %{section name=dimsec loop=$dim}%
    	<option value="%{$dim[dimsec].id}%" %{if $dim[dimsec].is_current}%selected="selected"%{/if}%>%{$dim[dimsec].name|escape:"html"}%</option>
    %{/section}%
    </select>
   
    </td>
    
     <td width="100" >
   
   
    <select name="group_id" id="group_id" style="width:100px;">
    %{section name=groupsec loop=$group}%
    	<option value="%{$group[groupsec].id}%" %{if $group[groupsec].is_current}%selected="selected"%{/if}%>%{$group[groupsec].name|escape:"html"}%</option>
    %{/section}%
    </select>
    
    <select name="two_group_id" id="group_id2" style="width:100px;">
    %{section name=two_groupsec loop=$two_group}%
    	<option value="%{$two_group[two_groupsec].id}%" %{if $two_group[two_groupsec].is_current}%selected="selected"%{/if}%>%{$two_group[two_groupsec].name|escape:"html"}%</option>
    %{/section}%
    </select>
    
    <select name="three_group_id" id="group_id3" style="width:100px;">
    %{section name=three_groupsec loop=$three_group}%
    	<option value="%{$three_group[three_groupsec].id}%" %{if $three_group[three_groupsec].is_current}%selected="selected"%{/if}%>%{$three_group[three_groupsec].name|escape:"html"}%</option>
    %{/section}%
    </select>
    
    <script type="text/javascript">
	$(function(){
		$("#group_id").bind("change", function(){
			//alert('zz');
			$.ajax({
				async: true,
				url: "/js/catalog.php",
				type: "POST",
				data:{
					"action":"redraw_two_groups",
					"group_id":$("#group_id").val()
				},
				beforeSend: function(){
					  
				},
				success: function(data){
				  $("#group_id3").empty();
				  $("#group_id2").html('<option value=""></option>'+data);
				  
				},
				error: function(xhr, status){
					//alert("Ошибка выбора подгрупп.");	
				}	 
			});
		});
		
		$("#group_id2").bind("change", function(){
			//alert('zz');
			$.ajax({
				async: true,
				url: "/js/catalog.php",
				type: "POST",
				data:{
					"action":"redraw_two_groups",
					"group_id":$("#group_id2").val()
				},
				beforeSend: function(){
					  
				},
				success: function(data){
				  $("#group_id3").html('<option value=""></option>'+data);
				  
				},
				error: function(xhr, status){
					//alert("Ошибка выбора подгрупп.");	
				}	 
			});
		});
	});
	</script>
    
    </td>
    
    
 
    <td  width="40" >
   <input type="text" size="8" maxlength="255" value="%{$gost_tu2}%" name="gost_tu2" id="gost_tu2" style="width:40px;" />
   
    </td>
    
    
   
    
     <td width="40"  >
     <input type="text" size="4" maxlength="255" value="%{$length2}%" name="length2" id="length2" style="width:40px;" />
   
    </td>
    <td width="40" >
    <input type="text" size="4" maxlength="255" value="%{$width2}%" name="width2" id="width2" style="width:40px;" />
   
   
    </td>
    <td width="40" >
    <input type="text" size="4" maxlength="255" value="%{$height2}%" name="height2" id="height2"style="width:40px;" />
   
    </td>
    <td width="40"  >
   <input type="text" size="4" maxlength="255" value="%{$diametr2}%" name="diametr2" id="diametr2" style="width:40px;" />
    </td> 
    
  
  	
  </tr>
</thead>
</table>
</div>



<div style="float:left; margin-right:5px;"><br />



<a href="#" id="donot_ext_search" style="display:none;"><img src="/img/icons/minus.jpg" width="24" height="24" alt="скрыть расширенный поиск" title="скрыть расширенный поиск"  hspace="5" border="0" /></a>

<script type="text/javascript">
		$(function(){
			$("#donot_ext_search").unbind("click");
			$("#donot_ext_search").bind("click",function(){
				
				$("#name2_1").attr("value",$("#name2").val());
				$("#name2").attr("value","");
				$("#name2").attr("name","nn");
				$("#name2_1").attr("name","name2");
				
				$("#donot_ext_search").css("display","none");
				$("#search_full").css("display","none");
				$("#dimension_id2").val("");
				$("#length2").val("");
				$("#width2").val("");
				$("#height2").val("");
				$("#weight2").val("");
				$("#volume2").val("");
				$("#diametr2").val("");
				
				$("#group_id").val("");
				$("#group_id2").val("");
				$("#group_id3").val("");
				
				$("#search_shorter").css("display","block");
				return false;
			});
		});
		</script>
         <script type="text/javascript">
		$(function(){
			$("#do_ext_search").unbind("click");
			$("#do_ext_search").bind("click",function(){
				
				$("#name2").attr("value",$("#name2_1").val());
				
				
				$("#search_shorter").css("display","none");
				$("#donot_ext_search").css("display","inline");
				$("#search_full").css("display","block");
				$("#name2_1").attr("value","");
				
				$("#name2_1").attr("name","nn");
				$("#name2").attr("name","name2");
				
				return false;
			});
		});
		</script>

<input type="image" name="doSub" id="doSub" src="/img/icons/old-zoom-original.png" border="0" alt="Найти" title="Найти" />

<a href="an_onway.php?doSub=1"><img src="/img/icons/old-zoom-deselect.png" width="24" height="24" alt="Сбросить все фильтры" title="Сбросить все фильтры" border="0"  /></a>

  
  %{if $can_print}%
  
   <div id="or_print_dialog" title="Выберите режим сортировки при печати">
    <strong>Выберите, в каком режиме Вы желаете распечатать отчет:</strong><br />

    	
        <input type="radio" name="print_ord_mode" id="print_ord_mode0" value="%{$sortmode}%" checked="checked" />
	    <strong>общим списком распоряжений на приемку</strong>        
        <br />
        
        <input type="radio" name="print_ord_mode" id="print_ord_mode1" value="1" />
	    <strong>сортировка по плановой дате поставки</strong>        
        <br />
        
        <input type="radio" name="print_ord_mode" id="print_ord_mode9" value="9" />
	    <strong>сортировка по статусу</strong>        
        <br />
		
        
        <input type="radio" name="print_ord_mode" id="print_ord_mode11" value="11" />
	    <strong>сортировка по контрагенту</strong>        
        <br />
        
         <input type="radio" name="print_ord_mode" id="print_ord_mode7" value="7" />
	    <strong>сортировка по менеджеру</strong>        
        <br />

        
       
    </div>
  
  
  <a href="#" id="print_table"><img src="/img/icons/print.png" width="24" height="24" alt="Печать..." title="Печать..." border="0"  /></a>
  
  
  <script type="text/javascript">
  $(function(){
	  
	  $("#or_print_dialog").dialog({
			autoOpen: false,
			modal: true,
			width: 350,
			height: 250,
			stack: true,
			buttons:{
				"Печать":function(){
					//проверить режим, распечатать в режиме
					sortmode=$("input[id^=print_ord_mode]:checked").val();
					//alert(sortmode);
					
					window.open('an_onway.php?tab_page=1&print='+'1'+'&pdate_shipping_plan1='+$("#pdate_shipping_plan1").val()+'&pdate_shipping_plan2='+$("#pdate_shipping_plan2").val()+'&sortmode='+sortmode+'&id2='+$("#id2").val()+'&name2='+$("input[name=name2]").attr("value")+'&group_id='+$("#group_id").val()+'&two_group_id='+$("#group_id2").val()+'&three_group_id='+$("#group_id3").val()+'&gost_tu2='+$("#gost_tu2").val()+'&dimension_id2='+$("#dimension_id2").val()+'&length2='+$("#length2").val()+'&width2='+$("#width2").val()+'&height2='+$("#height2").val()+'&diametr2='+$("#diametr2").val(), 'onway','width=1100,height=700,toolbar=1,menubar=1,resizable=1,status=1,scrollbars=1');
					
					$("#or_print_dialog").dialog("close");
				},
				"Отмена":function(){
					$("#or_print_dialog").dialog("close");
				}
				
			}
		});
	  
	  
	  
	  $("#print_table").bind("click",function(){
		// $("#print").val(1);
		
		//alert($("#storage_id").val());
		//если явно выбрана сортировка либо если выбраны фильтры - то не спрашивать.
		if((parseInt('%{$sortmode}%')>1)){
			
		 	 window.open('an_onway.php?tab_page=1&print='+'1'+'&pdate_shipping_plan1='+$("#pdate_shipping_plan1").val()+'&pdate_shipping_plan2='+$("#pdate_shipping_plan2").val()+'&sortmode='+'%{$sortmode}%'+'&id2='+$("#id2").val()+'&name2='+$("input[name=name2]").attr("value")+'&group_id='+$("#group_id").val()+'&two_group_id='+$("#group_id2").val()+'&three_group_id='+$("#group_id3").val()+'&gost_tu2='+$("#gost_tu2").val()+'&dimension_id2='+$("#dimension_id2").val()+'&length2='+$("#length2").val()+'&width2='+$("#width2").val()+'&height2='+$("#height2").val()+'&diametr2='+$("#diametr2").val(), 'onway','width=1100,height=700,toolbar=1,menubar=1,resizable=1,status=1,scrollbars=1');
		 
		}else{
			
			//диалог с выбр режимом печати
			$("#or_print_dialog").dialog("open");	
			
		}
		 return false; 
	  });
	  
  });
  </script>
  
  %{else}%
  <a href="#" onclick="alert('У Вас недостаточно прав для печати отчета.'); return false;"><img src="/img/icons/print-gr.png" width="24" height="24" alt="печать..." title="печать..." border="0" /></a>
 %{/if}%
  
</div>
<br clear="all" />




<style type="text/css">
	.blacktable th.small, td.small{
		font-size:10px !important;
		/*color:#666;	*/
	}
</style>




<div id="info_positions_dialog" title="О позиции">
<div id="position_info"></div>

</div>
 <script type="text/javascript">
  $(function(){
     $("#info_positions_dialog").dialog({
	  autoOpen: false,
	  modal: true,
	  width: 550,
	  height: 250,
	  buttons: {
		  "Закрыть": function(){
		   $(this).dialog("close");	
		  }
		}
	 });
	 
	
	
  });
	</script>



<small>
1. Вы можете осуществлять отбор распоряжений на приемку по нескольким позициям. Для этого в форму поиска нужно вписать через точку с запятой фрагменты искомых названий  и нажать кнопку <img src="/img/icons/old-zoom-original.png" alt="Найти" title="Найти" border="0" />.<br />
2. Для того, чтобы осуществить расширенный поиск по позициям распоряжений на приемку (по коду позиции, ГОСТ/ТУ, длине, ширине, высоте, диаметру), необходимо нажать кнопку <img src="/img/icons/plus.png" width="24" height="24" alt="расширенный поиск" title="расширенный поиск" border="0" />, заполнить соответствующие поля и нажать кнопку <img src="/img/icons/old-zoom-original.png" alt="Найти" title="Найти" border="0" />.

<br />
3. По умолчанию отчет формируется без фильтра по периоду: все распоряжения со всеми плановыми датами поставки. Для того, чтобы отфильтровать распоряжения с плановыми датами поставки за определенный период, необходимо выбрать нужные даты в фильтре "Период" и нажать кнопку <img src="/img/icons/old-zoom-original.png" alt="Найти" title="Найти" border="0" />.
</small>
<p />




%{if $do_it}%
<script type="text/javascript">
//"%{$items[rowsec].id}%", "%{$items[rowsec].positions[possec].position_id}%", "%{$items[rowsec].positions[possec].bill_id}%", "%{$items[rowsec].positions[possec].pl_position_id}%", "%{$items[rowsec].positions[possec].pl_discount_id}%" , "%{$items[rowsec].positions[possec].pl_discount_value}%", "%{$items[rowsec].positions[possec].pl_discount_rub_or_percent}%", "%{$items[rowsec].positions[possec].out_bill_id}%"
	function link_in_bills(sh_i_id, position_id,  bill_id, pl_position_id, pl_discount_id, pl_discount_value, pl_discount_rub_or_percent, out_bill_id){
		$.ajax({
				  async: true,
				  url: "/js/ship_in.php",
				  type: "POST",
				  data:{
					  "action":"find_bills_pos",
					 	"sh_i_id":sh_i_id,
						"position_id":position_id,
						"bill_id":bill_id,
						"pl_position_id":pl_position_id,
						"pl_discount_id":pl_discount_id,
						"pl_discount_value":pl_discount_value,
						"pl_discount_rub_or_percent":pl_discount_rub_or_percent,
						"out_bill_id":out_bill_id
				  },
				  beforeSend: function(){
						$("#position_info").html('<img src="/img/images/wait.gif" width="32" height="32" alt="подождите, пожалуйста..." border="0" />');
				  },
				  success: function(data){
					$("#position_info").html(data);
					
				  },
				  error: function(xhr, status){
					 // $("#pos_rows").html("Ошибка загрузки позиций.");	
				  }	 
				});
			  
			  $("#info_positions_dialog").dialog("open");
			  return false;
		
	}
	
	function link_in_sh(sh_i_id, position_id,  bill_id, pl_position_id, pl_discount_id, pl_discount_value, pl_discount_rub_or_percent, out_bill_id){
		$.ajax({
				  async: true,
				  url: "/js/ship_in.php",
				  type: "POST",
				  data:{
					  "action":"find_sh_pos",
					 "sh_i_id":sh_i_id,
						"id":position_id,
						"bill_id":bill_id,
						"pl_position_id":pl_position_id,
						"pl_discount_id":pl_discount_id,
						"pl_discount_value":pl_discount_value,
						"pl_discount_rub_or_percent":pl_discount_rub_or_percent,
						"out_bill_id":out_bill_id
				  },
				  beforeSend: function(){
					$("#position_info").html('<img src="/img/images/wait.gif" width="32" height="32" alt="подождите, пожалуйста..." border="0" />');
				  },
				  success: function(data){
					$("#position_info").html(data);
					
				  },

				  error: function(xhr, status){
					 // $("#pos_rows").html("Ошибка загрузки позиций.");	
				  }	 
				});
			  
			  $("#info_positions_dialog").dialog("open");
			  return false;
		
	}
	
	function link_in_pol(sh_i_id, position_id,  bill_id, pl_position_id, pl_discount_id, pl_discount_value, pl_discount_rub_or_percent, out_bill_id){
		$.ajax({
					async: true,
					url: "/js/ship_in.php",
					type: "POST",
					data:{
						"action":"find_acc_pos",
						"sh_i_id":sh_i_id,
						"id":position_id,
						"bill_id":bill_id,
						"pl_position_id":pl_position_id,
						"pl_discount_id":pl_discount_id,
						"pl_discount_value":pl_discount_value,
						"pl_discount_rub_or_percent":pl_discount_rub_or_percent,
						"out_bill_id":out_bill_id
					},
					beforeSend: function(){
					  $("#position_info").html('<img src="/img/images/wait.gif" width="32" height="32" alt="подождите, пожалуйста..." border="0" />');
					},
					success: function(data){
					  $("#position_info").html(data);
					  
					},
					error: function(xhr, status){
					   // $("#pos_rows").html("Ошибка загрузки позиций.");	
					}	 
				  });
			  $("#info_positions_dialog").dialog("open");
			  return false;
		
	}
	
	

</script>
<table width="100%" border="1" cellspacing="0" cellpadding="2" class="blacktable">
 <thead>
  <tr align="center" valign="top">
    
    
    <th scope="col" width="20" rowspan="3">
    № 
    
    </th>
    
    
      <th scope="col" width="40" rowspan="3">
    Плановая дата поставки
    <div class="sort_dir">
    <a href="%{$link}%&sortmode=1"><img src="/img/up.gif" border="0" alt="" width="11" height="16" /></a>
    <a href="%{$link}%&sortmode=0"><img src="/img/down.gif" border="0" alt="" width="11" height="16" /></a>
    </div>
    </th>
    
    
 
  
   
      
   
    
      <th scope="col" width="60" rowspan="3">Статус
     <div class="sort_dir">
    <a href="%{$link}%&sortmode=9"><img src="/img/up.gif" border="0" alt="" width="11" height="16" /></a>
    <a href="%{$link}%&sortmode=8"><img src="/img/down.gif" border="0" alt="" width="11" height="16" /></a>
    </div>
    </th>
    
    
   <th scope="col" width="*" colspan="7">Позиции в пути 
   
    </th>
    
    
     <th scope="col" width="50" rowspan="3" >Контрагент 
     <div class="sort_dir">
    <a href="%{$link}%&sortmode=11"><img src="/img/up.gif" border="0" alt="" width="11" height="16" /></a>
    <a href="%{$link}%&sortmode=10"><img src="/img/down.gif" border="0" alt="" width="11" height="16" /></a>
    </div>
    </th>
    
    <th scope="col" width="80" rowspan="3" >Создал 
    <div class="sort_dir">
    <a href="%{$link}%&sortmode=7"><img src="/img/up.gif" border="0" alt="" width="11" height="16" /></a>
    <a href="%{$link}%&sortmode=6"><img src="/img/down.gif" border="0" alt="" width="11" height="16" /></a>
    </div>
    </th>
    
    
    
    
    
    
   
 
  </tr>
  
  <tr align="center" valign="top">
  <th scope="col" width="20" class="small" rowspan="2">
    № п/п
    </th>
    <th scope="col" width="*"  class="small" rowspan="2">Наименование</th>
    <th scope="col" width="20" class="small" style="min-width:20px; width:20px; max-width:30px;" rowspan="2">
     ед. изм.
    </th>
   
     <th scope="col" width="30" class="small" style="min-width:30px; width:30px; max-width:40px;" colspan="4">
    по показанному распоряжению на приемку:
     </tr>
  
  <tr align="center" valign="top">
    
    
    
    <th scope="col" width="30" class="small" style="min-width:30px; width:30px; max-width:40px;">
     Во вх. счете
    </th>
    <th scope="col" width="30" class="small" style="min-width:30px; width:30px; max-width:40px;">
    В расп. на приемку
    </th>
    <th scope="col" width="30" class="small" style="min-width:30px; width:30px; max-width:40px;">
    Получе- но
    </th>
    <th scope="col" width="30" style="min-width:30px; width:30px; max-width:40px; font-weight:bold;">
    В пути
    </th>
   
  </tr>
  
  
 </thead>
 <tbody>
   %{section name=rowsec loop=$items}%
    %{section name=possec loop=$items[rowsec].positions}%%{/section}%
   <tr align="left" valign="top">
    
    <td width="20" rowspan="%{$smarty.section.possec.total}%"><a href="ed_ship_in.php?action=1&id=%{$items[rowsec].id}%&from_begin=1" target="_blank">%{$items[rowsec].id}%</a> </td>
    
     <td width="40"  rowspan="%{$smarty.section.possec.total}%">%{$items[rowsec].pdate_shipping_plan}%&nbsp;</td>
    
    
  
    
  
    
    <td width="60" rowspan="%{$smarty.section.possec.total}%">
    
    
    
    %{if $items[rowsec].status_id==3}%
    аннулировано
 
    %{elseif $items[rowsec].status_id==1}%
    не утверждено
    
    %{elseif $items[rowsec].status_id==2}%
    утверждено
    %{elseif $items[rowsec].status_id==7}%
    не выполнено
    %{elseif $items[rowsec].status_id==8}%
    выполнено
    %{/if}%
    
  
    
    
    </td>
   
   
 
 	%{section name=possec loop=$items[rowsec].positions}%
    %{if $smarty.section.possec.index==0}%
	%{include file="an_onway/an_row.html"}%
   %{/if}%
	%{/section}%
 
 
 	 <td width="50" rowspan="%{$smarty.section.possec.total}%" >
    <a href="supplier.php?action=1&id=%{$items[rowsec].supplier_id}%" target="_blank">%{$items[rowsec].supplier_name}%, %{$items[rowsec].supplier_opf}% </a>
    </td>
   
     <td width="80" rowspan="%{$smarty.section.possec.total}%" >
    %{$items[rowsec].manager_name}% (%{$items[rowsec].manager_login}%)
    </td>
    
   
  
    
     
   
     
   </tr>
   
    %{section name=possec loop=$items[rowsec].positions}%
	 %{if $smarty.section.possec.index>0}%   
    <tr align="left" valign="top" id="pos_block_%{$smarty.section.rowsec.index}%_%{$smarty.section.possec.index}%" class="small">
	%{include file="an_onway/an_row.html"}%
    </tr>
    %{/if}%
	%{/section}%
   %{/section}%
  </tbody>
</table>
%{/if}%    

</form>