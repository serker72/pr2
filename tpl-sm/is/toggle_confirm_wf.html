%{if $item.status_id==3}%
<strong>списание не утв.</strong>
%{elseif $item.is_confirmed_wf==0}%
    <strong>списание не утв.</strong>
    %{if $can_confirm_wf}%
    <input type="button" value="Утвердить" id="confirm_wf_%{$item.id}%" %{if $item.is_confirmed==0}% disabled="disabled"%{/if}% />
    %{/if}% 
    %{else}%
    <strong>списание утв.</strong>
    %{if  ($can_confirm_wf ) or $can_super_confirm_wf}%
    <input type="button" value="Не утвердить" id="confirm_wf_%{$item.id}%" />
    %{/if}% 
%{/if}%
    <br />

    %{$item.confirmed_wf_name}% %{$item.confirmed_wf_login}% %{$item.confirm_wf_pdate}%
    
    %{if $can_confirm_wf or $can_super_confirm_wf}%
    <script type="text/javascript">
	$(function(){
		$("#confirm_wf_%{$item.id}%").bind("click",function(){
			
			
			
			%{if $item.is_confirmed_wf==1}%
			
			
			var can_ret=true;
			$.ajax({
				async: false,
				url: "/js/is.php",
				type: "POST",
				data:{
					"action":"check_unconfirm",
					id: "%{$item.id}%"
				},
				beforeSend: function(){
					  
				},
				success: function(data){
				  if(data!=0){
					 
					 alert("Невозможно снять утверждение списания по распоряжению %{$item.id}%. Причина:\n"+data+"\nДля снятия утверждения списания по распоряжению необходимо снять утверждения всех связанных документов."); 
					 can_ret=false;
				  }
				},
				error: function(xhr, status){
					
					alert("Ошибка при проверке состояния распоряжения. Пожалуйста, попытайтесь сохранить распоряжение снова.");
					can_ret=false;	
				}	 
			});
			//если все в порядке - то делать... иначе
			if(can_ret){
			if(window.confirm("Вы уверены, что хотите снять утверждение списания по распоряжению на межсклад %{$item.id}%?")){
			
			
			%{elseif $item.is_confirmed_wf==0}%
			
			var can_ret=true;
			$.ajax({
				async: false,
				url: "/js/is.php",
				type: "POST",
				data:{
					"action":"check_confirm",
					id: "%{$item.id}%"
				},
				beforeSend: function(){
					  
				},
				success: function(data){
				 // alert(data);
				  if(data!=0){
					 
					 alert("Невозможно утвердить списание по распоряжению %{$item.id}%. Причина:\n"+data+""); 
					 can_ret=false;
				  }
				},
				error: function(xhr, status){
					
					alert("Ошибка при проверке состояния распоряжения. Пожалуйста, попытайтесь сохранить распоряжение снова.");
					can_ret=false;	
				}	 
			});
			if(can_ret){
			%{/if}%
			
			var can_go=true;
			%{if $item.is_confirmed_wf==0}%
			
			//проверить недостачи... вывести информационное подтверждение
			$.ajax({
				async: false,
				url: "/js/is.php",
				type: "POST",
				data:{
					"action":"check_lacks",
					id: "%{$item.id}%"
				},
				beforeSend: function(){
					//alert('zz');   
				},
				success: function(data){
					
					if(data==0){
						
					}else{
						if(window.confirm("Внимание! При списании с участка "+$("#sender_sector_name_%{$item.id}%").html()+", объекта "+$("#sender_storage_name_%{$item.id}%").html()+" недостача составляет:\n"+data+"Пожалуйста, проверьте количества позиций.\nЕсли у Вас произошла недостача, пожалуйста, свяжитесь с сотрудником отдела снабжения.\nПродолжить утверждение списания?")){
							if(window.confirm("Вы уверены?")){
								
							}else can_go=can_go&&false;
						}else can_go=can_go&&false;
						
					}
				},
				error: function(xhr, status){
					alert("Ошибка проверки состояния распоряжения на межсклад. Пожалуйста, повторите попытку.");	
					can_go=can_go&&false;
				}	 
			});
			
			
			if(can_go){
			  $.ajax({
				  async: false,
				  url: "/js/is.php",
				  type: "POST",
				  data:{
					  "action":"check_komplekts_fakt",
					  id: "%{$item.id}%"
				  },
				  beforeSend: function(){
					  //alert('zz');   
				  },
				  success: function(data){
					  if(data==1){
						  
					  }else{
						  alert("Перемещение товара невозможно, так как нет заявки на участок "+$("#receiver_sector_name_"+"%{$item.id}%").text()+" на позиции распоряжения на межсклад!\nСоздайте соответствующую заявку.");
						  //$("#is_confirmed_wf").prop("checked",false);
						  can_go=can_go&&false;
					  }
				  },
				  error: function(xhr, status){
					  alert("Ошибка проверки состояния распоряжения на межсклад. Пожалуйста, повторите попытку.");	
					  can_go=can_go&&false;					//
				  }	 
			  });
			}
			%{/if}%
			
			if(can_go){
				$.ajax({
				  async: true,
				  url: "/js/%{$filename}%",
				  type: "POST",
				  data:{
					  "action":"toggle_confirm_wf",
					  "id":"%{$item.id}%",
					  "shorter":"%{$shorter}%"
				  },
				  beforeSend: function(){
						$("#item_row_%{$items[rowsec].id}%").html('<td colspan="14"><img src="/img/wait.gif" width="32" height="32" alt=""></td>');
				  },
				  success: function(data){
					 $("#item_row_%{$items[rowsec].id}%").html(data);
				  },
				  error: function(xhr, status){
					  //alert("Ошибка добавления %{$named}%.");	
				  }	 
			  });
			}
			
			
			%{if $item.is_confirmed_wf==1 }%
			}
			}else{
				
			}
			%{elseif $item.is_confirmed_wf==0 }%
			}
			%{/if}%
			
			
		});
	});
	</script>
    %{/if}%
    
    